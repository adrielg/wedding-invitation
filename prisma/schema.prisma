generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum EventType {
  wedding              // Casamiento
  fifteen              // 15 Años
  adult_birthday       // Cumpleaños Adulto
  childrens_event      // Evento Infantil
  babyshower           // Baby Shower
  corporate            // Evento Corporativo
  family_celebration   // Celebración Familiar
  other                // Otro
}

enum PlanType {
  standard  // Cliente crea su evento
  premium   // Nosotros lo creamos personalizado
}

enum PaymentStatus {
  pending   // Esperando confirmación de MP
  approved  // Aprobado
  rejected  // Rechazado
  refunded  // Devuelto
}

model Event {
  id          String      @id @default(uuid())
  slug        String      @unique // URL amigable: "boda-juan-maria"
  name        String      // "Boda de Juan y María"
  type        EventType
  date        DateTime
  location    String?
  description String?
  owner_id    String?     // Para multi-tenancy futuro
  password    String?     // Contraseña para que el cliente acceda a sus RSVPs
  is_active   Boolean     @default(true)
  created_at  DateTime    @default(now())
  updated_at  DateTime    @updatedAt
  
  config      EventConfig?
  rsvps       Rsvp[]
  payment     Payment?    // Relación 1:1 con Payment
  
  @@map("events")
}

model Payment {
  id                  String        @id @default(uuid())
  email               String        // Email del cliente
  phone               String?       // Teléfono (opcional)
  plan                PlanType      // standard o premium
  status              PaymentStatus @default(pending)
  amount              Float         // Monto pagado
  mercadopago_id      String?       @unique // ID de pago de MercadoPago
  preference_id       String?       // ID de preferencia de MP
  event_id            String?       @unique // NULL si aún no creó evento (premium) o no usó el pago
  event               Event?        @relation(fields: [event_id], references: [id], onDelete: SetNull)
  created_at          DateTime      @default(now())
  updated_at          DateTime      @updatedAt
  
  @@map("payments")
  @@index([email])
  @@index([mercadopago_id])
}

model EventConfig {
  id                String   @id @default(uuid())
  event_id          String   @unique
  event             Event    @relation(fields: [event_id], references: [id], onDelete: Cascade)
  
  // Configuración del formulario
  requires_menu     Boolean  @default(true)
  requires_dietary  Boolean  @default(true)
  requires_allergies Boolean @default(true)
  max_adults        Int      @default(10)
  max_children      Int      @default(10)
  
  // Configuración de tema/diseño
  theme_primary_color    String  @default("#f43f5e") // rose-600
  theme_secondary_color  String  @default("#fda4af") // rose-300
  theme_background       String  @default("gradient") // gradient | solid | image
  theme_font_family      String  @default("Playfair Display")
  hero_image_url         String?
  gallery_images         Json?   // Array de URLs de imágenes
  
  // Contenido del evento
  venue_name             String? // Nombre del lugar
  venue_address          String? // Dirección
  venue_map_url          String? // URL del iframe de Google Maps
  ceremony_time          String? // Hora de ceremonia
  reception_time         String? // Hora de recepción
  parking_info           String? // Info de estacionamiento
  dress_code             String? // Código de vestimenta
  timeline_events        Json?   // Array de {time, title, icon}
  
  // Campos personalizados (JSON)
  custom_fields     Json?
  
  created_at        DateTime @default(now())
  updated_at        DateTime @updatedAt
  
  @@map("event_configs")
}

model Rsvp {
  id                        String   @id @default(uuid())
  event_id                  String   // ← NUEVO: Relacionado al evento
  event                     Event    @relation(fields: [event_id], references: [id], onDelete: Cascade)
  
  nombre                    String
  apellido                  String
  asistencia                String
  menores_cinco             Int      @default(0)
  entre_cinco_diez          Int      @default(0)
  mayores_diez              Int      @default(0)
  restricciones_alimentarias String?
  mensaje                   String?
  created_at                DateTime @default(now())

  @@map("rsvps")
  @@index([event_id])
}

